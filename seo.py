import requests
from bs4 import BeautifulSoup
import re
import os
from os.path import exists

def checkSEO(url):
    try:
        os.mkdir('report')
        os.chdir('report')
    except:
        os.chdir('report')
    if(exists('seo_problem.txt')):
        os.remove('seo_problem.txt')
    f = open("seo_problem.txt" , "a")
    f.write("URL" + " : " + url +"\n")
    response = requests.get(url)
    soup = BeautifulSoup(response.text , "html.parser")

    metas = soup.find_all('meta') #Get Meta Description
    # print(metas)
    desc = ""
    title = ""
    ogtitle = ""
    title = soup.find('title')
    viewport = ""
    charset = ""
    Dict = {}
    Dict[url] = ""
    heads = soup.find_all("h1")
    if(len(heads) > 1):
        f.write("Used excessive h1 Tag\n")
    if(len(title.text) > 120):
        f.write("Your title is too long to fit in for SERP\n")
    elif(title.text == ""):
        f.write("Your website doesnt contain Title tag\n")
    for m in metas:
        if m.get ('name') == 'description':
            desc = m.get('content')
        if m.get('property') == 'og:title':
            ogtitle = m.get('content')
        if m.get('name') == 'viewport':
            viewport = (m.get('content')).replace(" " , "")
        charset = soup.meta['charset']
    if(desc == ""):
        f.write("this website has no description meta tag\n" )
        Dict[url].append("this website has no description meta tag\n")
    else:
        f.write(desc +"\n")
    if(ogtitle == ""):
        f.write("this website has no ogtitle")
        Dict[url].append("this website has no ogtitle\n")
    else:
        f.write(ogtitle +"\n")
    if(viewport == ""):
        f.write("Viewport is not set for your webpage")
        Dict[url].append("Viewport is not set for your webpage")
    if(charset == "" and charset != "UTF-8" and charset != "utf-8"):
        f.write("you can set your encoding to UTF-8")
        Dict[url].append("you can set your encoding to UTF-8")
    f.write(str(Dict) +"\n\n")
    if(Dict[url] != ""):
        f.append(Dict , "\n")
    f.close()
    os.chdir("./..")
if(__name__=="__main__"):
    checkSEO('https://www.searchenginejournal.com/seo-tasks-automate-with-python/351050/#close')